<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar - AI UMKM</title>
    <meta name="description" content="Daftar akun baru di platform AI UMKM">
    
    <!-- CSS -->
    <link rel="stylesheet" href="src/css/style.css">
    <link rel="stylesheet" href="src/css/register.css">
    <link rel="stylesheet" href="src/css/fontawesome/css/all.min.css">
    
    <!-- Font Inter & Poppins dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation Header -->
    <header class="header">
        <nav class="nav" aria-label="Main navigation">
            <div class="nav-links">
                <div class="nav-content">
                    <a href="index.html" class="nav-link">Beranda</a>
                    <a href="login.html" class="nav-link">Masuk</a>
                </div>
                <div class="header-content">
                    <h1 class="logo">
                        <a href="index.html"><span class="span">U</span>MKM <span class="span">AI</span></a>
                    </h1>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- REGISTER SECTION -->
        <section class="login-section">
            <div class="features">
                <div class="container">
                    <div class="card">
                        <div class="p-2">
                            <h3>Daftar ke AI UMKM</h3>

                            <form id="signupForm" class="auth-form">
                                <div class="form-group">
                                    <label for="signupName">Nama Lengkap</label>
                                    <input id="signupName" type="text" class="form-input" required placeholder="Masukkan nama lengkap">
                                </div>
                                
                                <div class="form-group">
                                    <label for="signupEmail">Email</label>
                                    <input id="signupEmail" type="email" class="form-input" required placeholder="Masukkan email Anda">
                                </div>
                                
                                <div class="form-group">
                                    <label for="signupPassword">Kata Sandi</label>
                                    <input id="signupPassword" type="password" class="form-input" required placeholder="Buat kata sandi (min. 6 karakter)">
                                </div>
                                
                                <div class="form-group">
                                    <label for="signupPasswordConfirm">Konfirmasi Kata Sandi</label>
                                    <input id="signupPasswordConfirm" type="password" class="form-input" required placeholder="Ulangi kata sandi">
                                </div>
                                
                                <button type="submit" class="btn btn-primary btn-generate">Daftar Sekarang</button>
                                
                                <p class="muted" style="text-align: center; margin-top: 1rem;">
                                    Sudah punya akun? <a href="login.html" class="link-like">Masuk di sini</a>
                                </p>
                            </form>

                            <div class="text-center mt-2">
                                <a href="index.html" class="btn btn-secondary">Kembali ke Beranda</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- FOOTER -->
        <footer class="footer">
            <p>&copy; 2025 AI UMKM - Platform AI untuk UMKM Indonesia</p>
            <p>Membantu usaha lokal berkembang dengan teknologi kecerdasan buatan</p>
        </footer>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <p id="toast-message">Pesan berhasil disalin!</p>
    </div>

    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- JavaScript -->
    <script src="src/js/utils.js"></script>
    <script src="src/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            // Check if already authenticated, redirect to dashboard
            await redirectIfAuthenticated();
            
            // Handle register form submission
            const signupForm = document.getElementById('signupForm');
            
            if (signupForm) {
                signupForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    // Get form values
                    const name = document.getElementById('signupName').value.trim();
                    const email = document.getElementById('signupEmail').value.trim();
                    const password = document.getElementById('signupPassword').value;
                    const confirmPassword = document.getElementById('signupPasswordConfirm').value;
                    
                    // Validation
                    if (!name) {
                        showToast('Nama lengkap harus diisi!');
                        return;
                    }
                    
                    if (!email) {
                        showToast('Email harus diisi!');
                        return;
                    }
                    
                    if (password !== confirmPassword) {
                        showToast('Kata sandi dan konfirmasi tidak sama!');
                        return;
                    }
                    
                    if (password.length < 6) {
                        showToast('Kata sandi minimal 6 karakter!');
                        return;
                    }
                    
                    // Disable submit button
                    const submitBtn = signupForm.querySelector('button[type="submit"]');
                    const originalText = submitBtn.textContent;
                    submitBtn.disabled = true;
                    submitBtn.textContent = 'Mendaftar...';
                    
                    // Register with Supabase
                    const result = await Auth.register(email, password, name);
                    
                    if (result.success) {
                        showToast('Pendaftaran berhasil! Silakan cek email untuk konfirmasi.');
                        
                        // Clear form
                        signupForm.reset();
                        
                        // Redirect to login after 2 seconds
                        setTimeout(() => {
                            window.location.href = 'login.html';
                        }, 2000);
                    } else {
                        // Handle error
                        let errorMessage = 'Pendaftaran gagal! ';
                        
                        if (result.error.includes('already registered')) {
                            errorMessage += 'Email sudah terdaftar.';
                        } else if (result.error.includes('Invalid email')) {
                            errorMessage += 'Format email tidak valid.';
                        } else {
                            errorMessage += result.error;
                        }
                        
                        showToast(errorMessage);
                        
                        // Re-enable submit button
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                    }
                });
            }
        });
        
        // Toast notification function
        function showToast(message) {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            
            if (toast && toastMessage) {
                toastMessage.textContent = message;
                toast.classList.remove('hidden');
                
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3000);
            }
        }
    </script>
</body>
</html>